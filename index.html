<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš› ××¢×¨×›×ª × ×™×”×•×œ ×”×–×× ×•×ª ğŸ“¦</title>
    <!-- ×¡×¤×¨×™×™×ª Chart.js ×œ×™×¦×™×¨×ª ×’×¨×¤×™× (×¢× DataLabels) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- ××™×™×§×•× ×™× (Font Awesome) -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Arial', sans-serif;
            direction: rtl;
            text-align: center;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
        }
        .header {
            background-color: #007bff;
            color: white;
            padding: 15px;
            font-size: 24px;
            font-weight: bold;
        }
        .clock {
            font-size: 22px;
            font-weight: bold;
            background-color: #ff0000;
            color: white;
            padding: 10px;
            margin: 10px auto;
            width: fit-content;
            border-radius: 10px;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        /* ××¡×’×¨×ª ×œ×’×¨×¤×™× */
        .charts-frame {
            width: 95%;
            margin: 20px auto;
            border: 2px dashed #aaa;
            border-radius: 10px;
            padding: 10px;
        }
        .chart-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .chart-box {
            width: 250px;
            height: 250px;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }
        /* ×˜×‘×œ×ª ×”×”×–×× ×•×ª ×‘×¦×“ ×™××™×Ÿ*/
        .orders-section {
            display: flex;
            flex-direction: row-reverse; /* ×˜×‘×œ×” ×œ×¦×“ ×™××™×Ÿ */
            width: 100%;
            justify-content: flex-end;
        }
        .orders-table {
            width: 50%;
            margin: 20px;
            border-collapse: collapse;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        input, select, button {
            padding: 8px;
            font-size: 16px;
            margin: 5px;
            border-radius: 5px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #218838;
        }
        .delete-btn {
            background-color: red;
            font-size: 16px;
            padding: 5px;
        }
        .delete-btn:hover {
            background-color: darkred;
        }
        /* ×¦×‘×¢×™× ×œ×¡×˜×˜×•×¡×™× */
        .status-ready {
            background-color: green;
            color: white;
            animation: blink 1s infinite;
        }
        .status-in-progress {
            background-color: yellow;
            color: black;
            animation: blink 1s infinite;
        }
        .status-delayed {
            background-color: red;
            color: white;
            animation: blink 1s infinite;
        }
        .status-supka {
            background-color: purple;
            color: white;
            animation: blink 1s infinite;
        }
        /* ×¡×’× ×•×Ÿ ×œ×˜×•×¤×¡ ×”×”×–×× ×” ×‘×¦×“ ×©×××œ */
        .order-form-container {
            width: 40%;
            margin: 20px;
        }
        table {
            width: 100%;
        }

        /* ××–×•×¨ ×œ×”×–×× ×” ×”×§×¨×•×‘×” */
        .next-order-container {
            margin: 20px auto;
        }
        .next-order-blink {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
            background-color: #ff00ff;
            padding: 10px;
            margin: 10px auto;
            width: fit-content;
            border-radius: 10px;
            animation: blink 1s infinite;
        }
    </style>
</head>
<body>

    <!-- ×›×•×ª×¨×ª -->
    <div class="header">
        <i class="fas fa-truck"></i> ××¢×¨×›×ª × ×™×”×•×œ ×”×–×× ×•×ª ğŸš›ğŸ“¦
    </div>

    <!-- ×©×¢×•×Ÿ ××•×Ÿ ×œ×™×™×Ÿ ×¦×‘×¢×•× ×™ -->
    <div class="clock" id="currentTime"></div>

    <!-- ××–×•×¨ ×œ×”×–×× ×” ×”×§×¨×•×‘×” -->
    <div class="next-order-container">
        <h2>ğŸš¨ ×”×–×× ×” ×§×¨×•×‘×”</h2>
        <div class="next-order-blink" id="nextOrderInfo">××™×Ÿ ×”×–×× ×•×ª ×›×¨×’×¢</div>
    </div>

    <!-- ××¡×’×¨×ª ×”×’×¨×¤×™× -->
    <div class="charts-frame">
        <h2>ğŸ”¢ ×’×¨×¤×™× ×•× ×ª×•× ×™×</h2>
        <div class="chart-container">
            <div class="chart-box">
                <h3>ğŸ“¦ ×›××•×ª ×”×–×× ×•×ª</h3>
                <canvas id="totalOrdersChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>âœ… ×”×–×× ×•×ª ××•×›× ×•×ª</h3>
                <canvas id="readyOrdersChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>ğŸš› ×”×–×× ×•×ª ×œ×¤×™ × ×”×’</h3>
                <canvas id="driverOrdersChart"></canvas>
            </div>
        </div>
    </div>

    <div class="orders-section">
        <!-- ×˜×•×¤×¡ ×”×–×× ×” ×‘×¦×“ ×™××™×Ÿ -->
        <div class="order-form-container">
            <h1>ğŸ“‹ ×˜×•×¤×¡ ×”×–×× ×”</h1>
            <!-- ×˜×•×¤×¡ ×”×–×× ×” -->
            <form id="orderForm">
                <table>
                    <tr>
                        <th>ğŸ‘¤ ×©× ×œ×§×•×—</th>
                        <td><input type="text" id="customerName" required></td>
                    </tr>
                    <tr>
                        <th>ğŸ“ ×›×ª×•×‘×ª ××¡×¤×§×”</th>
                        <td><input type="text" id="deliveryAddress" required></td>
                    </tr>
                    <tr>
                        <th>ğŸ· ××—×¡×Ÿ</th>
                        <td>
                            <select id="warehouse" required>
                                <option value="××—×¡×Ÿ ×”×—×¨×©">××—×¡×Ÿ ×”×—×¨×©</option>
                                <option value="××—×¡×Ÿ ×”×ª×œ××™×“">××—×¡×Ÿ ×”×ª×œ××™×“</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>ğŸšš ×¡×•×’ ×”×•×‘×œ×”</th>
                        <td>
                            <select id="transportType" required>
                                <option value="××©××™×ª">××©××™×ª</option>
                                <option value="×× ×•×£">×× ×•×£</option>
                                <option value="×× ×•×£ 15 ××˜×¨">×× ×•×£ 15 ××˜×¨</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>ğŸ‘· × ×”×’</th>
                        <td>
                            <select id="driverName" required>
                                <option value="×—×›××ª">×—×›××ª</option>
                                <option value="×©××•×œ">×©××•×œ</option>
                                <option value="×¢×œ×™">×¢×œ×™</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>â° ×©×¢×ª ××¡×¤×§×”</th>
                        <td>
                            <select id="deliveryTime" required>
                            </select>
                        </td>
                    </tr>
                </table>
                <button type="button" onclick="addOrder()">ğŸ“¦ ×”×•×¡×£ ×”×–×× ×”</button>
            </form>
        </div>

        <div style="width: 60%; margin: 20px;">
            <!-- ×§×• ××¤×¨×™×“ -->
            <hr style="margin: 30px 0;">
            <h2>ğŸ“œ ×¨×©×™××ª ×”×–×× ×•×ª</h2>
            <table class="orders-table" id="ordersTable">
                <thead>
                    <tr>
                        <th>×©× ×œ×§×•×—</th>
                        <th>×›×ª×•×‘×ª ××¡×¤×§×”</th>
                        <th>××—×¡×Ÿ</th>
                        <th>×¡×•×’ ×”×•×‘×œ×”</th>
                        <th>× ×”×’</th>
                        <th>×©×¢×ª ××¡×¤×§×”</th>
                        <th>×¡×˜×˜×•×¡</th>
                        <th>××—×™×§×”</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // ×¨×™×©×•× ×”×¤×œ××’×™×Ÿ ×©×œ DataLabels
        Chart.register(ChartDataLabels);

        let orders = [];

        // ×˜×•×•×— ×©×¢×•×ª ×-06:00 ×¢×“ 17:00 ×‘×›×œ ×—×¦×™ ×©×¢×”
        const timeOptions = generateTimeSlots("06:00", "17:00", 30);

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×¨×©×™××ª ×–×× ×™ ×—×¦×™ ×©×¢×”
        function generateTimeSlots(start, end, stepMinutes) {
            const slots = [];
            let startParts = start.split(":");
            let endParts = end.split(":");

            let startHour = parseInt(startParts[0]);
            let startMinute = parseInt(startParts[1]);
            let endHour = parseInt(endParts[0]);
            let endMinute = parseInt(endParts[1]);

            let currentHour = startHour;
            let currentMinute = startMinute;

            while (currentHour < endHour || (currentHour === endHour && currentMinute <= endMinute)) {
                const hh = String(currentHour).padStart(2, '0');
                const mm = String(currentMinute).padStart(2, '0');
                slots.push(`${hh}:${mm}`);

                // ×”×•×¡×¤×ª ×“×§×•×ª
                currentMinute += stepMinutes;
                if (currentMinute >= 60) {
                    currentHour++;
                    currentMinute -= 60;
                }
            }
            return slots;
        }

        // ×××œ× ××ª ×”-select ×‘×©×¢×•×ª ×”××¡×¤×§×”
        const deliveryTimeSelect = document.getElementById('deliveryTime');
        timeOptions.forEach(t => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.textContent = t;
            deliveryTimeSelect.appendChild(opt);
        });

        // ×ª×¨×©×™×: ×›××•×ª ×”×–×× ×•×ª
        const totalOrdersChart = new Chart(document.getElementById('totalOrdersChart'), {
            type: 'doughnut',
            data: {
                labels: ['×”×–×× ×•×ª'],
                datasets: [{
                    label: '××¡×¤×¨ ×›××•×ª ×”×–×× ×•×ª', // ×ª×•×•×™×ª ×œ×’×¨×£
                    data: [0],
                    backgroundColor: ['#007bff']
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: true
                    },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold'
                        },
                        display: true,
                        formatter: (value, ctx) => {
                            return value;
                        }
                    }
                }
            }
        });

        // ×ª×¨×©×™×: ×”×–×× ×•×ª ××•×›× ×•×ª ×œ×¢×•××ª ×œ× ××•×›× ×•×ª
        const readyOrdersChart = new Chart(document.getElementById('readyOrdersChart'), {
            type: 'doughnut',
            data: {
                labels: ['××•×›× ×•×ª', '×œ× ××•×›× ×•×ª'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#28a745', '#ff0000']
                }]
            },
            options: {
                plugins: {
                    legend: {
                        display: true
                    },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold'
                        },
                        display: true,
                        formatter: (value, ctx) => {
                            return value;
                        }
                    }
                }
            }
        });

        // ×ª×¨×©×™×: ×”×–×× ×•×ª ×œ×¤×™ × ×”×’
        const driverOrdersChart = new Chart(document.getElementById('driverOrdersChart'), {
            type: 'bar',
            data: {
                labels: ['×—×›××ª', '×©××•×œ', '×¢×œ×™'],
                datasets: [{
                    label: '××¡×¤×¨ ×”×–×× ×•×ª',
                    data: [0, 0, 0],
                    backgroundColor: ['#007bff', '#28a745', '#ff0000']
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    datalabels: {
                        color: '#000',
                        font: {
                            weight: 'bold'
                        },
                        anchor: 'end',
                        align: 'top',
                        display: true,
                        formatter: (value, ctx) => {
                            return value;
                        }
                    }
                }
            }
        });

        // ×”×•×¡×¤× ×• '×¡×•×¤×§×”' ×›×¡×˜×˜×•×¡ ×—×“×©
        const statuses = ['××•×›× ×”', '×‘×˜×™×¤×•×œ', '××ª×¢×›×‘×ª', '×¡×•×¤×§×”'];

        // ×¤×•× ×§×¦×™×” ×©××—×–×™×¨×” ××ª ××—×œ×§×ª ×”-CSS ×”× ×›×•× ×” ×œ×¤×™ ×”×¡×˜×˜×•×¡
        function getStatusClass(status) {
            if (status === '××•×›× ×”') return 'status-ready';
            if (status === '×‘×˜×™×¤×•×œ') return 'status-in-progress';
            if (status === '××ª×¢×›×‘×ª') return 'status-delayed';
            if (status === '×¡×•×¤×§×”') return 'status-supka';
            return '';
        }

        // ×××™×¨ 'HH:MM' ×œ×“×§×•×ª
        function timeToMinutes(timeStr) {
            const [hh, mm] = timeStr.split(":");
            return parseInt(hh)*60 + parseInt(mm);
        }

        // ×××™×™×Ÿ ××ª orders ×œ×¤×™ ×©×¢×ª ××¡×¤×§×”
        function sortOrders() {
            orders.sort((a,b) => timeToMinutes(a.deliveryTime) - timeToMinutes(b.deliveryTime));
        }

        // ×¢×“×›×•×Ÿ ×”×‘×× ×¨ ×©×œ ×”×”×–×× ×” ×”×§×¨×•×‘×”
        function updateNextOrderBanner() {
            const nextOrderDiv = document.getElementById('nextOrderInfo');
            if (!nextOrderDiv) return;
            if (orders.length === 0) {
                nextOrderDiv.innerHTML = '××™×Ÿ ×”×–×× ×•×ª ×›×¨×’×¢';
                return;
            }
            // ×œ××—×¨ ×”××™×•×Ÿ, ×”×”×–×× ×” ×”×§×¨×•×‘×” ×‘×™×•×ª×¨ ×ª×”×™×” orders[0]
            const earliest = orders[0];
            nextOrderDiv.innerHTML = `×œ×§×•×—: ${earliest.customerName}, × ×”×’: ${earliest.driverName}`;
        }

        // ×¢×“×›×•×Ÿ ×›×œ ×”×’×¨×¤×™×
        function updateCharts() {
            // ×ª×¨×©×™× ×›××•×ª ×”×–×× ×•×ª
            totalOrdersChart.data.datasets[0].data = [orders.length];
            totalOrdersChart.update();

            // ×ª×¨×©×™× ×”×–×× ×•×ª ××•×›× ×•×ª (× ×—×©×‘×•×ª ×¨×§ '××•×›× ×”')
            const readyCount = orders.filter(order => order.status === '××•×›× ×”').length;
            readyOrdersChart.data.datasets[0].data = [readyCount, orders.length - readyCount];
            readyOrdersChart.update();

            // ×ª×¨×©×™× ×”×–×× ×•×ª ×œ×¤×™ × ×”×’
            const drivers = ['×—×›××ª', '×©××•×œ', '×¢×œ×™'];
            const driverCounts = drivers.map(driver =>
                orders.filter(order => order.driverName === driver).length
            );
            driverOrdersChart.data.datasets[0].data = driverCounts;
            driverOrdersChart.update();
        }

        // ×”×•×¡×¤×ª ×”×–×× ×” ×—×“×©×”
        function addOrder() {
            const order = {
                customerName: document.getElementById('customerName').value,
                deliveryAddress: document.getElementById('deliveryAddress').value,
                warehouse: document.getElementById('warehouse').value,
                transportType: document.getElementById('transportType').value,
                driverName: document.getElementById('driverName').value,
                deliveryTime: document.getElementById('deliveryTime').value,
                status: '×‘×˜×™×¤×•×œ' // ×‘×¨×™×¨×ª ××—×“×œ ×œ×”×–×× ×” ×—×“×©×”
            };

            orders.push(order);
            sortOrders();
            renderOrders();
            updateNextOrderBanner();
            updateCharts();
        }

        // ×”×¦×’×ª ×”×”×–×× ×•×ª ×‘×˜×‘×œ×”
        function renderOrders() {
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';

            orders.forEach((order, index) => {
                tbody.innerHTML += `
                    <tr class="${getStatusClass(order.status)}">
                        <td>${order.customerName}</td>
                        <td>${order.deliveryAddress}</td>
                        <td>${order.warehouse}</td>
                        <td>${order.transportType}</td>
                        <td>${order.driverName}</td>
                        <td>
                            <select onchange="updateOrderTime(${index}, this.value)">
                                ${timeOptions.map(t => `<option value='${t}' ${t === order.deliveryTime ? 'selected' : ''}>${t}</option>`).join('')}
                            </select>
                        </td>
                        <td><button onclick="updateStatus(${index})">${order.status}</button></td>
                        <td><button class="delete-btn" onclick="deleteOrder(${index})">ğŸ—‘</button></td>
                    </tr>
                `;
            });
        }

        // ×©×™× ×•×™ ×¡×˜×˜×•×¡ ×”×”×–×× ×”
        function updateStatus(index) {
            // ×”××¢×‘×¨ ××ª×‘×¦×¢ ×œ×¤×™ ×”×¡×“×¨ ×‘××¢×¨×š statuses
            const currentStatus = orders[index].status;
            const currentIndex = statuses.indexOf(currentStatus);
            orders[index].status = statuses[(currentIndex + 1) % statuses.length];
            sortOrders();
            renderOrders();
            updateNextOrderBanner();
            updateCharts();
        }

        // ××—×™×§×ª ×”×–×× ×”
        function deleteOrder(index) {
            orders.splice(index, 1);
            sortOrders();
            renderOrders();
            updateNextOrderBanner();
            updateCharts();
        }

        // ×©×™× ×•×™ ×–××Ÿ ××¡×¤×§×” ×“×™× ××™
        function updateOrderTime(index, newTime) {
            orders[index].deliveryTime = newTime;
            sortOrders();
            renderOrders();
            updateNextOrderBanner();
            updateCharts();
        }

        // ×¢×“×›×•×Ÿ ×”×©×¢×•×Ÿ
        function updateClock() {
            document.getElementById('currentTime').innerText = new Date().toLocaleString('he-IL');
        }
        setInterval(updateClock, 1000);
    </script>
</body>
</html>
